#!/bin/bash
mypy_path=$1
mypy_flags=$2
requirements_file=$4

# install requirements_file, if defined
if [ ! -z "$requirements_file" ]; then
    pip install -r /requirements.txt
else
    pip install -r "$requirements_file"
fi

output_file=/tmp/action.out

# get mypy version
echo "$(mypy --version)"
mypy $mypy_flags --show-column-numbers --hide-error-context $mypy_path | tee "${output_file}"
exit_code="${PIPESTATUS[0]}"

python bin/mypy/mypy.py "${output_file}"

exit "$exit_code"