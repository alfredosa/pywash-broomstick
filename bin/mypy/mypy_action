#!/bin/bash
mypy_path=$1
mypy_flags=$2


# install requirements_file, if defined
if [ ! -z "$3" ]; then
    pip install -r $4
fi

output_file=/tmp/action.out

# get mypy version
mypy --version

# run mypy, tee output to file
# shellcheck disable=2086
mypy $mypy_flags --show-column-numbers --hide-error-context $mypy_path | tee "${output_file}"
exit_code="${PIPESTATUS[0]}"

# analyze output
python /github.py "${output_file}"

exit "$exit_code"